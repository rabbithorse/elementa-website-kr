<template>
  <div>
    <section class="subSection relative" ref="subSection">
      <div class="h-screen flex items-center">
        <Container>
          <div class="heading text-center">
            <h2 class="text-[11rem] leading-1 font-bold text-white subPageTitle relative justify-center">
              <TypographyPrimary>
                E
              </TypographyPrimary>
              <TypographyPrimary>
                l
              </TypographyPrimary>
              <TypographyPrimary>
                e
              </TypographyPrimary>
              <TypographyPrimary>
                m
              </TypographyPrimary>
              <TypographyPrimary>
                e
              </TypographyPrimary>
              <TypographyPrimary>
                n
              </TypographyPrimary>
              <TypographyPrimary>
                t
              </TypographyPrimary>
              <TypographyPrimary>
                <svg xmlns="http://www.w3.org/2000/svg" width="128" height="131" viewBox="0 0 128 131" fill="none">
                  <mask id="mask0_1935_891" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="34" y="63" width="46" height="68">
                  <path d="M34.2905 130.624H56.0333L79.8045 63.5234H57.9983L34.2905 130.624Z" fill="white"/>
                  </mask>
                  <g mask="url(#mask0_1935_891)">
                  <path d="M5.448 113.833L45.6372 43.668L108.583 80.3145L68.3942 150.415L5.448 113.833Z" fill="url(#paint0_linear_1935_891)"/>
                  </g>
                  <path d="M80.1833 2.42578L69.4705 32.0494L105.286 130.625H127.472L80.1833 2.42578Z" fill="white"/>
                  <mask id="mask1_1935_891" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="69" height="131">
                  <path d="M46.3381 0L0 130.625H21.8061L68.0808 0H46.3381Z" fill="white"/>
                  </mask>
                  <g mask="url(#mask1_1935_891)">
                  <path d="M-56.1636 97.9368L17.0518 -29.6875L124.244 32.6243L51.0922 160.312L-56.1636 97.9368Z" fill="url(#paint1_linear_1935_891)"/>
                  </g>
                  <defs>
                  <linearGradient id="paint0_linear_1935_891" x1="19.9376" y1="161.631" x2="94.5885" y2="33.2514" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#00C8EB"/>
                  <stop offset="0.2088" stop-color="#00C8EB"/>
                  <stop offset="0.7372" stop-color="#734BD7"/>
                  <stop offset="1" stop-color="#734BD7"/>
                  </linearGradient>
                  <linearGradient id="paint1_linear_1935_891" x1="-6.91495" y1="136.797" x2="111.302" y2="-66.5039" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#00C8EB"/>
                  <stop offset="0.042" stop-color="#00C8EB"/>
                  <stop offset="0.0484" stop-color="#02C6EB"/>
                  <stop offset="0.2631" stop-color="#3292E2"/>
                  <stop offset="0.4494" stop-color="#556BDC"/>
                  <stop offset="0.5981" stop-color="#6B54D8"/>
                  <stop offset="0.6907" stop-color="#734BD7"/>
                  <stop offset="1" stop-color="#734BD7"/>
                  </linearGradient>
                  </defs>
                </svg>
              </TypographyPrimary>
              
            </h2>
            <p class="text-white pt-[1.25rem] text-[3.125rem] relative">
              게임의 미래를 설계하고, 세계가 함께 공감하는 문화를 만든다
            </p>
          </div>
        </Container>
      </div>
      <div class="h-screen flex items-center pt-[3.75rem]" ref="missionSection">
        <Container class="h-full">
          <div class="section-heading">
            <div class="heading-text flex flex-col md:gap-y-10 gap-y-4">
              <span class="sectionTitle-eng text-white md:text-base text-[3.4vw] relative before:absolute before:left-0 before:top-1/2 before:-translate-y-1/2 before:animate-pulse before:bg-[#00C8EB] md:before:w-3 md:before:h-3 before:w-[0.625rem] before:h-[0.625rem] before:rounded-full pl-5">Our Mission</span>
            </div>
          </div>
          <div class="section-content pt-[8.75rem]">
            <div class="mission-wrap grid grid-cols-12 gap-x-4 relative">
              <div class="bgtitle absolute left-0">
                <h2 class="text-[#9FAEB5] text-[10rem] font-paperlogy font-extrabold text-center" ref="bgTitle">
                  <TypographyPrimary>
                    O
                  </TypographyPrimary>
                  <TypographyPrimary>
                    U
                  </TypographyPrimary>
                  <TypographyPrimary>
                    R
                  </TypographyPrimary>

                  <br>
                  <TypographyPrimary>
                    M
                  </TypographyPrimary>
                  <TypographyPrimary>
                    I
                  </TypographyPrimary>
                  <TypographyPrimary>
                    S
                  </TypographyPrimary>
                  <TypographyPrimary>
                    S
                  </TypographyPrimary>
                  <TypographyPrimary>
                    I
                  </TypographyPrimary>
                  <TypographyPrimary>
                    O
                  </TypographyPrimary>
                  <TypographyPrimary>
                    N
                  </TypographyPrimary>
                </h2>
              </div>
              <div class="mission-text-wrapper absolute">
                <div class="flex gap-x-52" ref="missionTextWrap">
                  <div class="flex flex-col items-center">
                    <span class="text-[#7B728F] text-[3.125rem] whitespace-nowrap">게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다 게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다.</span>
                    <h2 class="text-[#7B728F] text-[16.25rem] font-paperlogy font-extrabold">INNOVATION</h2>
                  </div>
                  <div class="flex flex-col items-center">
                    <span class="text-[#728D8F] text-[3.125rem] whitespace-nowrap">게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다 게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다.</span>
                    <h2 class="text-[#728D8F] text-[18.75rem] font-paperlogy font-extrabold">Trust Trust</h2>
                  </div>
                  <div class="flex flex-col items-center">
                    <span class="text-[#728F7F] text-[3.125rem] whitespace-nowrap">게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다 게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다.</span>
                    <h2 class="text-[#728F7F] text-[18.75rem] font-paperlogy font-extrabold">Culture</h2>
                  </div>
                  <div class="flex flex-col items-center">
                    <span class="text-[#8F8872] text-[3.125rem] whitespace-nowrap">게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다 게임의 미래를 재설계합니다.  게임의 미래를 재설계합니다.</span>
                    <h2 class="text-[#8F8872] text-[18.75rem] font-paperlogy font-extrabold">Experience</h2>
                  </div>
                </div>
              </div>
              <div class="mission-img-wrapper col-start-5 col-end-9">
                <div class="flex relative" ref="missionImgWrap">
                  <div class="card z-[1]">
                    <img src="@/assets/images/sub/company-mission-card01.png" alt="">
                  </div>
                  <div class="card">
                    <img src="@/assets/images/sub/company-mission-card02.png" alt="">
                  </div>
                  <div class="card">
                    <img src="@/assets/images/sub/company-mission-card03.png" alt="">
                  </div>
                  <div class="card">
                    <img src="@/assets/images/sub/company-mission-card04.png" alt="">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </Container>
      </div>
      <div class="h-screen flex items-center">
        <div class="section-heading">
          <p class="text-white">혁신적 경험으로 게임의 기준을 새로 쓰고, <br>협력과 도전으로 문화를 확장하며, <br>전 세계가 공감할 지속 가능한 감동을 만드는 문화·패러다임의 선도자로 성장하겠습니다.</p>
          <h2 class="text-white">ELEMENTA</h2>
        </div>
      </div>
      <div class="company-scroll " ref="scrollSection">
        <div class="heading flex items-center justify-center w-full gap-x-7" ref="scrollFixedHeading">
          <div class="heading-wrap w-full h-screen flex flex-col justify-center items-center">
            <h2 class="heading-title text-white text-[6.25rem] font-black leading-[1em] -mt-3">WE</h2>
            <span class="inline-block w-[25px]"><img src="@/assets/images/sub/company-scrollsection-slash.png" alt=""></span>
            <p class="text-white text-[1.125rem] text-left">
              <TypographySecondary>우리는 플레이를 통해 세상을 새롭게 정의합니다.</TypographySecondary> <br>
              <TypographySecondary>게임을 넘어, 모두가 공유할 수 있는 문화와 경험을 만들어갑니다.</TypographySecondary> <br>
              <TypographySecondary>끊임없는 도전과 창의적인 시도로 플레이의 미래를 디자인하고,</TypographySecondary> <br>
              <TypographySecondary>그 여정을 전 세계 유저와 함께 나눕니다.</TypographySecondary>
            </p>
          </div>
        </div>
        <div class="content-scroll-area flex flex-col gap-y-4" ref="contentScrollArea">
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card01.png" alt=""></div>
          </figure>
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card02.png" alt=""></div>
          </figure>
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card03.png" alt=""></div>
          </figure>
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card04.png" alt=""></div>
          </figure>
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card01.png" alt=""></div>
          </figure>
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card02.png" alt=""></div>
          </figure>
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card03.png" alt=""></div>
          </figure>
          <figure class="content-card w-fit">
            <div class="inner-img"><img src="@/assets/images/sub/company-scroll-card04.png" alt=""></div>
          </figure>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup>
  import { ref, onMounted } from 'vue';

  const { $gsap } = useNuxtApp();

  // Mission Section Refs
  const missionSection = ref(null);
  const bgTitle = ref(null);
  const missionImgWrap = ref(null);
  const missionTextWrap = ref(null);
  const scrollSection = ref(null);
  const scrollFixedHeading = ref(null);
  const contentScrollArea = ref(null);

  onMounted(() => {
    let cards = missionSection.value.querySelectorAll('.mission-img-wrapper .card');
    let cardsArray = Array.from(cards);
    
    const zDown = [
      [2, 0, 0, 0],   // 활성 1
      [1, 2, 0, 0],   // 활성 2
      [0, 1, 2, 0],    // 활성 3
      [0, 0, 1, 2]      // 활성 4
    ];

    // 스크롤 UP(-1)일 때 z-index 패턴
    const zUp = [
      [2, 1, 0, 0],   // 활성 1
      [0, 2, 1, 0],    // 활성 2
      [0, 0, 2, 1],     // 활성 3
      [0, 0, 1, 2]      // 활성 4
    ];

    const missionTl = $gsap.timeline({
      scrollTrigger: {
        pin: true,
        trigger: missionSection.value,
        start: 'top top',
        end: "+=1000%",
        scrub: true,
        onUpdate: (self) => {
          const p = self.progress;   
          //console.log(self.progress);
          if (p < 0.2) return;    
          const local = p / 0.9;               // 0 ~ 1
          const idx = Math.min(
            3, Math.floor(local * 4)
          );  // 0~3 (1~4번)
          updateZIndex(idx, self.direction);

          const dir = self.direction;                  // 1=down, -1=up
          
          const pattern = dir === 1 ? zDown[idx] : zUp[idx];

          // 패턴을 곧바로 z-index에 대입
          pattern.forEach((z, i) => {
            cardsArray[i].style.zIndex = z;
          });
        }
      }
    })

    

    missionTl.fromTo(bgTitle.value, {
      x: '80%'
    }, {
      x: '-150%',
      duration: 0.05
    }, 0)
    .fromTo(missionImgWrap.value, {
      x: '300%'
    }, {
      x: '0',
      duration: 0.2
    }, 0)
    .fromTo(missionTextWrap.value, {
      x: '22%'
    }, {
      x: '-78.8%',
      duration: 0.8
    }, ">-0.15");

    function updateZIndex(active, direction) {
      // 원하는 패턴에 맞춰 넣으면 됨
      //console.log("현재 카드:", active, "방향:", direction);
    }

    

    $gsap.timeline({
      scrollTrigger: {
        trigger: scrollSection.value,
        start: 'top top',
        end: "+=800%",
        scrub: 2,
        // markers: true,
        pin: scrollFixedHeading.value,
        pinSpacing: false
      },
    })

    const item = document.querySelectorAll('.content-card')

    item.forEach((el, i) => {
      // $gsap.to(el, {
      //   scrollTrigger: {
      //     trigger: el,
      //     start: '40% bottom',
      //     end: '40% top',
      //     // markers: true,
      //     onEnter: () => el.classList.add('on'),
      //   }
      // })

      const cardTl = $gsap.timeline({
        scrollTrigger: {
          trigger: el,
          start: "top 90%",
          duration: 1,
          scrub: true,
        }
      });

      const isOdd = (i % 2 === 1);
      const xOffset = isOdd ? ((window.innerWidth / 2.3) + 600) : ((window.innerWidth / 2.3) - 600); // 포물선 좌우 이동량
      const midX = isOdd ? ((window.innerWidth / 2.3) + 100) : ((window.innerWidth / 2.3) - 300);    // 중간 위치 살짝 이동

      // 포물선 궤적 만들기
      cardTl.set(el,
        {
          x: (window.innerWidth) / 2,           // 화면 중앙 정렬되어 있다고 가정
          opacity: 0,
          
        })
      .to(el, 
        {
          x: xOffset,     // 좌우로 벌어지기
          opacity: 1,
          ease: "power2.out",
          duration: 0.9
        })
      .to(el, 
        {
          x: (window.innerWidth) / 2,        // 위로 상승
          ease: "none",
        }, 0.9)

    })

    // const scrollTl = $gsap.timeline({
    //   scrollTrigger: {
    //     pin: true,
    //     trigger: scrollSection.value,
    //     start: 'top top',
    //     end: "+=300%",
    //     scrub: true,
    //   }
    // })
    
  })

</script>

<style scoped>
  .bgtitle .primary-char-wrap {
    margin-left: -5px;
  }

  .mission-img-wrapper .card:not(:first-child) {
    position: absolute;
    left: 0; 
    top: 0;
  }

  .company-scroll .content-card {


  }
</style>